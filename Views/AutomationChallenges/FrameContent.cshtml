@{
    Layout = null; // No layout for iframe content
    var frameNumber = ViewBag.FrameNumber ?? 1;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frame Content @frameNumber</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
</head>
<body>
    <div class="p-3" data-automation-id="frame-content-@frameNumber">
        <div class="alert alert-info mb-3" data-automation-id="frame-header">
            <h5 class="mb-0">
                <i class="bi bi-window"></i> iFrame Content - Level @frameNumber
            </h5>
        </div>

        @if (frameNumber == 1)
        {
            <div class="card" data-automation-id="frame-1-card">
                <div class="card-body">
                    <h6>Frame 1 - Simple iFrame</h6>
                    <p class="small text-muted">This content is inside a single iFrame</p>
                    
                    <div class="mb-3">
                        <label for="frame-input-1" class="form-label">Frame Input:</label>
                        <input type="text" 
                               class="form-control" 
                               id="frame-input-1" 
                               data-automation-id="frame-input"
                               placeholder="Type something in the frame">
                    </div>
                    
                    <button class="btn btn-primary" 
                            id="frame-button-1" 
                            data-automation-id="frame-button"
                            onclick="handleFrameClick(1)">
                        Click Me (Frame 1)
                    </button>
                    
                    <div class="mt-3 alert alert-success d-none" 
                         id="frame-result-1" 
                         data-automation-id="frame-result"
                         role="alert">
                    </div>
                </div>
            </div>
        }
        else if (frameNumber == 2)
        {
            <div class="card border-warning" data-automation-id="frame-2-card">
                <div class="card-body">
                    <h6>Frame 2 - Nested iFrame Parent</h6>
                    <p class="small text-muted">This frame contains another nested frame below</p>
                    
                    <button class="btn btn-warning" 
                            id="frame-button-2" 
                            data-automation-id="frame-button-parent"
                            onclick="handleFrameClick(2)">
                        Click Me (Parent Frame)
                    </button>
                    
                    <div class="mt-3 alert alert-warning d-none" 
                         id="frame-result-2" 
                         data-automation-id="frame-result-parent"
                         role="alert">
                    </div>
                    
                    <hr class="my-3" />
                    
                    <div class="alert alert-secondary">
                        <strong>Nested Frame Below:</strong>
                    </div>
                    
                    <iframe id="nested-frame" 
                            name="nested-frame"
                            data-automation-id="frame-nested-child"
                            src="@Url.Action("NestedFrameContent")" 
                            style="width: 100%; height: 200px; border: 2px solid #ffc107;">
                    </iframe>
                </div>
            </div>
        }
        else if (frameNumber == 3)
        {
            <div class="card border-dark" data-automation-id="frame-3-card">
                <div class="card-body">
                    <h6>Frame 3 - Shadow DOM inside iFrame</h6>
                    <p class="small text-muted">Expert challenge: Shadow DOM component inside an iFrame</p>
                    
                    <div id="frame-shadow-host" data-automation-id="frame-shadow-host">
                        <!-- Shadow DOM will be attached here -->
                    </div>
                    
                    <div class="mt-3">
                        <strong>Shadow Status:</strong>
                        <span id="frame-shadow-status" 
                              class="badge bg-secondary" 
                              data-automation-id="frame-shadow-status">
                            Not Initialized
                        </span>
                    </div>
                </div>
            </div>
        }
    </div>

    <script>
        function handleFrameClick(frameNum) {
            const input = document.getElementById('frame-input-' + frameNum);
            const result = document.getElementById('frame-result-' + frameNum);
            
            if (result) {
                result.classList.remove('d-none');
                const inputValue = input ? input.value : 'N/A';
                result.textContent = `Frame ${frameNum} button clicked! Input value: ${inputValue || '(empty)'}`;
            }
        }

        // If frame 3, create shadow DOM
        if (@frameNumber == 3) {
            document.addEventListener('DOMContentLoaded', function() {
                const shadowHost = document.getElementById('frame-shadow-host');
                const shadowRoot = shadowHost.attachShadow({ mode: 'open' });
                
                shadowRoot.innerHTML = `
                    <style>
                        .frame-shadow-container {
                            padding: 20px;
                            background-color: #e8f5e9;
                            border: 2px solid #4caf50;
                            border-radius: 8px;
                        }
                        .frame-shadow-button {
                            padding: 10px 20px;
                            background-color: #4caf50;
                            color: white;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                        }
                        .frame-shadow-input {
                            padding: 8px;
                            margin: 10px 0;
                            border: 1px solid #4caf50;
                            border-radius: 4px;
                            width: 100%;
                        }
                    </style>
                    <div class="frame-shadow-container">
                        <h6>Shadow DOM Inside iFrame</h6>
                        <p style="font-size: 0.9em; color: #666;">
                            This is the most challenging scenario!
                        </p>
                        <input type="text" 
                               class="frame-shadow-input" 
                               id="frame-shadow-input" 
                               data-automation-id="frame-shadow-input"
                               placeholder="Shadow input inside frame">
                        <button class="frame-shadow-button" 
                                id="frame-shadow-button" 
                                data-automation-id="frame-shadow-button">
                            Click Shadow Button (in Frame)
                        </button>
                        <div id="frame-shadow-output" 
                             data-automation-id="frame-shadow-output"
                             style="margin-top: 15px; padding: 10px; background-color: white; border-radius: 4px;">
                            Click button to test
                        </div>
                    </div>
                `;
                
                shadowRoot.getElementById('frame-shadow-button').addEventListener('click', function() {
                    const input = shadowRoot.getElementById('frame-shadow-input');
                    const output = shadowRoot.getElementById('frame-shadow-output');
                    output.innerHTML = `<strong>Success!</strong> You accessed Shadow DOM inside an iFrame!<br>Input: ${input.value || '(empty)'}`;
                    document.getElementById('frame-shadow-status').textContent = 'Button Clicked';
                    document.getElementById('frame-shadow-status').className = 'badge bg-success';
                });
                
                document.getElementById('frame-shadow-status').textContent = 'Initialized';
                document.getElementById('frame-shadow-status').className = 'badge bg-success';
            });
        }
    </script>
</body>
</html>
